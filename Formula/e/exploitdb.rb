class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-07",
      revision: "3711d1e88d802d73df74d4353c830231a5ae7a45"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "e2daf79253bde54bcaaf21283c945bb0d606b6eff56978a009eaaf54ff3eaabc"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "e14775df821ec6f54fa0e38aa06bfef5a458f53bc4857984afbda52a032974d9"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "4f2882b4f48846e59d36443574368d262c17d5583f0d98f15410fe3275ea1afd"
    sha256 cellar: :any_skip_relocation, sonoma:         "a823c039af2538240a488239d80867e7bde098bd7dbf0b716bb35772b8c7b78d"
    sha256 cellar: :any_skip_relocation, ventura:        "46fcf20d3ab6d5bbecd128cde5ec27474cc59b8bb31e0af92247b6bef7470bdb"
    sha256 cellar: :any_skip_relocation, monterey:       "17b8c1c0b417934c6316820065ee5720f352fa16572bbaf242af9bb1f9be326e"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "bf5985dabb777278d09f316390df510b6602d24a5e27a7fa28fb260493380fc7"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
